# 最終目標

建立本地的程式批改器，考生上傳程式後，機器可以自動輸入側資與隱藏側資，並報告各自是否通過。

(實作此程式的原因，是因為考試場域網路有問題，無法做online judge)

## 考生操作方式

1. 身分驗證或使用訪客身分
  
2. 下載題目(PDF)
  
3. 提供寫好的程式
  
4. 選擇題號
  
5. 程式提供編譯是否成功，然後各側資是否通過
  
6. 學生選擇下載特定公開側資(隱藏側資不予查看)
  

學生查證的大致介面範例：

| 公開測資 | 隱藏側資 |
| --- | --- |
| 通過(下載測資) | wrong |
| wrong answer(下載測資) | 通過  |
| Runtime-error(下載測資) | Runtime-error |

## 教師操作方式

- 身分驗證
  
- 提供題目(PDF)
  
- 提供該題的編譯腳本
  
- 提供側資
  
- 提供隱藏側資
  
- 上述皆提供完畢後，程式「將隱藏側資加密，與公開側資、題目一起打包為輸出檔(可為zip或自定義)」
  

## 其他

可以使用command line完成所有操作。

「上傳」、「下載」為借用網路操作，可以為複製等操作。例如，「下載」須將檔案複製到使用者容易尋找的地方(例如桌面，指定路徑等)。「上傳」須將檔案給予程式操作。

至少需要支援C++、Lex和yacc (可假設本地已有g++等必要編譯器)

請為跨平台實作。

## 預計向AI指出問題的回應(註：有些問題還沒答完)

(AI指出的問題，在檔案最下方)

首先，設計此程式的原因，是考試場域有網路問題，以此程式為替代方案。

以下是對您問題的回應：

角色與認證：

- 學生與教師。
  
- 教師身兼admin。
  
- 因為程式不可聯網，只要求教師登入，以避免學生接觸到非作答區域。
  

package 格式：預設為zip。若有困難，可以自行設計格式。

測資格式：

- 每個輸入/輸出皆為獨立檔案。雖然是文字文件，為避免編碼問題，以binary儲存。
  
- 側資檔名範例：輸入`1.in`，期望輸出`1.out`。
  

加密：

- 加密方式：不限，至少不能在3小時內破解。
  
- 題目與公開密碼：不會留電磁紀錄。教師會在考試當下，以實體方式(例如白板)告知。
  
- 隱藏側資：只有教師可存取。只有在批改當下由機器解密，批改完畢則刪除解密後測資。
  

提交格式：

- 限制單一檔案。考生可以選擇軟體支援語言。
  

執行環境：

- 需求有更動，只要支援Unix-like即可。
  
- 不須容器化。(若要跨平台)可以對每個作業系統發布不同版本。只要source code有跨平台即可。
  

編譯腳本：

- Q: 教師提供的腳本語言/格式需為何？如何避免執行風險？
  

判分細節：

- 原則上全對才過，但必須列出每個測資各自是否通過。因此，除了compiler error之外，必須測試所有測資。
  

報表格式：

- 介面顯示：須使學生容易閱讀。
  
- Q: 需要機器可讀（JSON）報表嗎？是否需匯出到 LMS？
  

Lex/Yacc 支援：

- 需求有變動，需打包相關程式。
  
- Q: bison/flex 的版本要求？系統是否自動執行 bison/flex？
  
- C++用C++11或C++17。
  

儲存與保留：

- Q: 是否需要執行隔離（sandbox）與攻擊面最小化（network 限制、syscalls 過濾）？
  
- Q: 是否需對教師提供的編譯腳本做簽章或審核流程？
  
- Q: 是否需要保留完整的操作紀錄（誰在何時打包/上傳/批改）？
  

併發/性能：

- 本地運行，因此只會有一位學生同時使用。
  

安全要求：

- Q: 需要哪些 sandbox/網路/系統呼叫限制？是否需要審計/操作紀錄？

# AI發現不精確的地方
我已閱讀 requirement.md 並檢視內容（目標：本地程式批改器），現在列出文件中「需要更精確或補充」的需求點、理由，以及每項對應的精確化問題或建議（方便你直接交給產品負責人或決策者回覆）。

## 需要更精確的需求項目（分類、理由與重點問題）

1. 使用者身分與驗證

- 為何不夠精確：
  - 文件只說「身分驗證或訪客」，沒有定義認證方式、權限邊界或管理帳號。
- 需要確認的細節／問題：
  - 需要哪些角色？（至少 Student / Teacher / Admin？還有助教、監考員等嗎？）
  - 認證方式要支援哪些？（本地帳號、LDAP/AD、OAuth、單一登入(SSO)、或僅檔案匯入？）
  - 訪客有何限制？能上傳、下載、查看哪些資源？
  - 是否需要帳號管理介面（新增/停用/重置密碼/權限管理）？

2. 題目與題目封裝格式（teacher 提供的資源）

- 為何不夠精確：
  - 文件說教師提供 PDF、編譯腳本、側資、隱藏側資，並把隱藏側資「加密」打包，但沒定義包的結構、命名規則或 manifest。
- 需要確認的細節／問題：
  - 希望的 package 格式：固定為 zip，還是允許自訂容器？需要 manifest（metadata）嗎？（建議：JSON manifest 包含題號、time/memory limits、編譯命令、測資列表、公開/隱藏標記）
  - 側資的檔案組織：每組測資是一對 input/output 檔案嗎？使用命名規則（in01.txt/out01.txt）還是單一目錄？
  - 編譯腳本的格式與執行假設（bash、powershell、Makefile、或一行命令？）
  - 加密方案：誰負責解密？用密碼、金鑰還是只在打包時混淆？如何管理金鑰／密碼？是否需要支援離線作業（無網路）？

3. 提交（上傳）與檔案格式

- 為何不夠精確：
  - 文件未說明學生上傳的檔案類型（單一檔案或多檔案、壓縮包、語言標記）、版本控制或大小限制。
- 需要確認的細節／問題：
  - 支援哪些提交格式？（單檔、zip、git repo URL）
  - 多檔/專案型支援：可否上傳多個檔案或專案結構？編譯腳本如何被指定/覆寫？
  - 是否需要學生選擇語言？系統如何推斷？
  - 有無檔案大小限制、禁止副檔名或黑名單？

4. 編譯與執行環境（安全與可重複性）

- 為何不夠精確：
  - 編譯腳本由教師提供，但未說如何安全執行、隔離（sandbox）、資源限制（time/memory）、或跨平台策略。
- 需要確認的細節／問題：
  - 必須支援的平台：Windows / Linux / macOS？（文件要求「跨平台」但未細化）
  - 是否允許教師提供任意 shell 指令？如何避免惡意腳本（sandbox、容器、限制權限）？
  - 每次編譯/執行的 time limit / memory limit / file I/O 限制為何？
  - 是否需用容器（Docker）或 OS-level sandbox？若跨平台，Windows 上的隔離策略為何？

5. 測試執行邏輯與判分規則

- 為何不夠精確：
  - 未說明測資的執行順序、是否停止於第一個失敗、分數制（每個 case 為通過/不通過或加權）、以及檢查方式（exact match、忽略空白、custom checker）。
- 需要確認的細節／問題：
  - 判定標準：逐字比對還是支援 custom checker 程式？
  - 是否支持部分分數（例如若 10 個測資，通過 7 個算 70 分）？
  - 是否停止在第一個失敗（fail-fast）或跑完所有測資並回報？
  - 要回傳哪些資訊給學生？（僅 PASS/FAIL，還是每個測資的 stdout/stderr/比較 diff/執行時間、記憶體使用）
  - 公開測資允許學生「下載輸入」僅，還是也提供輸出？

6. 公開側資與隱藏側資的可見性與下載策略

- 為何不夠精確：
  - 說學生「選擇下載特定公開側資」，但未定義哪些可下載、是否含正確輸出、以及對隱藏側資的保護方式。
- 需要確認的細節／問題：
  - 公開測資是否含標準輸出（正確輸出）？學生下載後可本地測試嗎？
  - 隱藏測資如何保存與加密？誰能解密？何時解密（grading 時）？
  - 是否允許學生下載僅導致某些錯誤的測資（例如只讓他們下載未通過的公開測資）？

7. 報告格式與整合（輸出）

- 為何不夠精確：
  - 未說明報告的格式（人類可讀、JSON、CSV）、是否保留歷史紀錄、或是否能整合 LMS。
- 需要確認的細節／問題：
  - 期望的輸出格式？（HTML 頁面、JSON API、或純文字）
  - 是否需提供可機器解析的報表（便於自動化或 LMS 匯入）？
  - 是否需保留學生提交/成績歷史？保存期限？

8. 支援語言與工具（C++、Lex、yacc）

- 為何不夠精確：
  - 文件只提到至少要支援 C++、Lex、yacc，未標明版本、編譯器參數或額外工具（bison/flex）。
- 需要確認的細節／問題：
  - 具體版本要求（g++ 版本、bison/flex 版本等）或可接受的最小版本？
  - 是否需支援其他語言（Python、Java 等）或外掛式語言支援？
  - Lex/Yacc 工作流程：系統要自動執行 flex/bison + 編譯嗎？教師要如何提供測資來測 lex/yacc 程式？

9. 可操作的 CLI 與 UI 範圍

- 為何不夠精確：
  - 文件說「可以使用 command line 完成所有操作」，但沒說是否還要 GUI 或網頁介面。
- 需要確認的細節／問題：
  - 是否必須同時提供 GUI（網頁）與 CLI？或僅 CLI 即可？
  - CLI 的命令集合需要包括哪些（新增題目、打包、上傳題目、批改、匯出報表）？
  - 若有網頁介面，是否需即時顯示測資執行狀態？

10. 平台相容性與部署方式（跨平台）

- 為何不夠精確：
  - 「請為跨平台實作」含糊：是指能在 Windows 與 Linux 上執行相同程式，還是指提供相同功能但分別打包？
- 需要確認的細節／問題：
  - 目標平台（Windows、Linux、macOS）的範圍是什麼？
  - 部署方式偏好：原生可執行、Python 腳本、Docker 映像、或可跨平台的二進位？
  - 若使用容器技術（例如 Docker），是否接受在 Windows 上需 WSL2 或 Docker Desktop 的前提？

11. 安全性與審計

- 為何不夠精確：
  - 執行學生或教師提供的程式與腳本會有安全風險，需求未提出安全要求或審計紀錄。
- 需要確認的細節／問題：
  - 是否需要執行隔離（sandbox）與攻擊面最小化（network 限制、syscalls 過濾）？
  - 是否需對教師提供的編譯腳本做簽章或審核流程？
  - 是否需要保留完整的操作紀錄（誰在何時打包/上傳/批改）？

12. 其他運營細節（儲存、保留策略、併發）

- 為何不夠精確：
  - 未指定儲存位置、容量限制、保留期限、或同時批改的容量需求。
- 需要確認的細節／問題：
  - 成果檔與測資存放在哪裡（本機硬碟、網路磁碟、資料庫）？
  - 是否需要限制同時批改數量、或支援 background queue？
  - 日誌與錯誤資料保存多久？

---

## 建議（如果要馬上開始實作，可先採用的合理預設）

如果你想讓開發團隊先動手，我建議先採用一組保守的合理假設（在未決議前作為暫定規格）：

- 角色：Student / Teacher / Admin；先用本地帳號（使用者檔案）並留擴充 LDAP 的接口。
- Package：使用 zip，並要求必須包含 `manifest.json`（題號、time_limit, memory_limit, compile_cmd, testcases: [{name, public:boolean, input, output}]）。
- 加密：隱藏測資以密碼加密（AES），教師在打包時指定一個密碼，系統在 grading 時使用同一密碼解密；後續再設計金鑰管理。
- 提交格式：接受單一檔案或 zip；若是多檔專案，要求上傳 zip。
- 編譯/執行：在 Linux 主機上以容器（Docker）或 sandbox（如 firejail / runc）執行，並有 time/memory 限制。若要跨平台，再針對 Windows 提供本地執行器或建議在 WSL2 下運行。
- 判分：跑完所有測資並回報每個測資的結果；預設為 exact match（可選擇 custom checker）。
- 輸出：提供 JSON 機器可讀報表，並同時有簡潔 HTML/文本檢視。

這些假設能讓團隊以最小可行產品（MVP）開始實作，但所有假設都應在開發前由需求方確認。

---

## 精確化問題清單（可直接發給需求方）

（已合併於上述每個項目底下；為便於複製，以下為精簡問題清單）

1. 角色與認證：有哪些角色？支援哪些認證方式？訪客權限為何？
2. package 格式：是否固定為 zip？是否需要 manifest？manifest 需要哪些欄位？
3. 測資格式：input/output 的命名規則與目錄結構？是否允許多組輸入合成一個測資？
4. 隱藏測資加密：希望的加密方式？由誰/如何管理密鑰或密碼？
5. 提交格式：只接受單檔或也接受 zip/repo？是否學生可上傳多檔？
6. 執行環境：目標支援平台（Windows/Linux/macOS）？是否強制要求容器化？
7. 編譯腳本：教師提供的腳本語言/格式需為何？如何避免執行風險？
8. 判分細節：是否需要 custom checker？是否支援部分分數？跑測資策略（fail-fast or full-run）？
9. 報表格式：需要機器可讀（JSON）報表嗎？是否需匯出到 LMS？
10. Lex/Yacc 支援：bison/flex 的版本要求？系統是否自動執行 bison/flex？
11. 儲存與保留：提交檔與報告保存多久？存放位置與容量限制？
12. 併發/性能：預計同時會有多少學生同時提交/批改？是否需要排隊與 limit？
13. 安全要求：需要哪些 sandbox/網路/系統呼叫限制？是否需要審計/操作紀錄？
14. UI 範圍：僅 CLI 即可還是也需要網頁 GUI？若有 GUI，是否需即時狀態更新？

---

## 下一步建議

- 若你想，我可以把上面「精確化問題清單」整理成一個短問卷（CSV/MD）給需求方，方便逐條簽核。
- 或者請告訴我你想採用哪些「假設」（我列的 MVP 假設），我可以立即開始設計系統的第一個版本（包含 manifest 規格、範例 package、以及在本地以 Docker 做 sandbox 的 prototype）。

---

## 目前 todo 狀態（最後更新）

- `Read requirement.md` — completed
- `Identify ambiguous requirements` — completed
- `Draft clarification questions` — completed

如果你要我把上述問題整理成郵件/問卷，或直接開始根據某些假設建立 prototype（例如：manifest 範例 + 打包/解密流程 + Docker-based grader），說明你偏好的預設（或哪幾項問題已確定），我就開始實作下一步。
  

UI 範圍：

- Q: 僅 CLI 即可還是也需要~~網頁~~ GUI？若有 GUI，是否需即時狀態更新？
