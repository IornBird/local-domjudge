# Message to Copilot

Do NOT read this file, The content is almost SAME to your context. It's only for convience for recording and writing mutiple line prompt.

# Content

---

---

IornBird: 請閱讀`requirements.md`，以軟體開發團隊的專業需求分析者身分，將我當作客戶，與我討論更清晰的軟體需求。您也可以猜測我的需求細節，讓我評估該猜測是否正確。

---

---

我會先建立工作清單並開始找出需求檔案以讀取其內容。

Created 6 todos

我要搜尋工作區中與需求檔名相符的檔案（嘗試 `requirements.md` 或 requirement.md）。

Searched for files matching `**/requirement*.md`, 1 match

Read [](file:///e%3A/move/D/%E7%A0%94%E7%A9%B6%E6%89%80/local%20domjudge/requirement.md)

我已讀取 requirement.md，現在把「讀取檔案」工作標為完成，並開始擷取功能性需求。

Starting: *擷取功能性需求摘要* (2/6)

進度更新：我已讀取並擷取需求檔案內容，下一步是將需求重點化並列出釐清問題與建議。下面以軟體需求分析師身份，針對您當作客戶的需求做整理、假設與釐清問題（中文，請審閱並回覆）：

**摘錄與重點（從 requirement.md）**

- 最終目標：建立一個「本地離線程式批改器」，學生上傳程式，系統以公開與隱藏測資測試並回報是否通過；此系統在考場環境中無網路可用。
- 使用者角色：學生（可匿名/訪客）、教師（管理者）。
- 工作流程：
  - 教師：上傳題目 PDF、編譯腳本、公開/隱藏測資，產生加密封裝檔（可為 zip 或自定義）。
  - 學生：下載題目（解密公開內容需公開密碼）、上傳程式並選題號進行本地批改、查看各測資結果、下載公開測資。
- 測資格式：以二進制儲存；資料夾 `public` / `private`；檔名為編號，副檔名 `.in` / `.out`（例如 `public/1.in`、`private/2.out`）。
- 隱私保護：隱藏測資保持加密，只有在測試輸入當下解密，執行後需清除/確保解密結果不留電磁紀錄。
- 編譯/執行回饋：
  - 顯示編譯錯誤訊息（若編譯失敗）
  - 執行若為 Runtime-error 顯示錯誤訊息；超時僅標示超時
  - 若執行完畢，為避免洩漏隱藏測資，只回報是否正確（不顯示隱藏輸出）
- 平台與工具：
  - Command-line 操作必須支援
  - 支援至少 C++17、Lex（flex）、Yacc（bison）等（具體版本待討論）
  - 僅需支援 Unix-like 作業系統
- 密碼機制與限制：
  - 運行中不提供密碼更改（需重新編譯程式才能改）
  - 有公開密碼與專用（教師）密碼兩種權限
  - 學生需公開密碼才可解出公開題目/測資；教師輸入專用密碼可解密所有內容

**我對需求的合理假設（請確認）**

- 假設 A：系統是一個本地可執行程式（CLI 為主），而非客戶端-伺服器架構；教師/學生在同一裝置上或使用相同離線環境執行操作。
- 假設 B：教師負責產生並分發封裝檔與公開密碼（考試開始時以非電子方式傳達給學生）。
- 假設 C：隱藏測資必須在測試期間短暫解密到磁碟或內存，並在結束時安全刪除；偏好僅在記憶體中處理以減少磁碟殘留風險，但考量到執行環境，可能需在臨時檔案並立即覆寫刪除。
- 假設 D：系統需提供教師產生封裝檔（打包+加密）與學生解封裝/測試兩套功能。
- 假設 E：多位學生同時在同一台機器上使用的情況不常見；系統可為單使用者（序列使用）設計，若需並行則另行設計沙箱/隔離機制。

請確認哪些假設正確，哪些不正確或需修正。

**主要模糊處與需釐清的問題（請逐項回覆）**

1. 帳號模型：是否需要長期的學生/教師帳號管理（帳戶、密碼、角色），或只以「公開密碼 / 專用密碼」為驗證方式（即無持久帳號）？
2. 密碼與金鑰管理：公開密碼與專用密碼是單純密碼導向的解密（對稱密鑰），還是需使用公鑰基礎設施？密碼如何安全分發與儲存？
3. 封裝檔格式：是否接受標準 `zip`（帶壓密密碼或加密）或需自定義容器格式（含 metadata）？若是 zip，是否有版本/相容性要求？
4. 隱私與擦除要求：您期待如何實現「不留電磁紀錄」？（例如，是否接受在磁碟上寫暫存檔並立即覆寫刪除，或必須完全在記憶體中處理？是否需支援 SSD 安全擦除的保證？）
5. 沙箱與安全：學生程式執行需否在完全隔離沙箱（例如 chroot、容器、seccomp、資源限制）中執行？有無惡意程式執行風險需要嚴格隔離？
6. 同步/並發：是否會有多名學生同時在同一台機器使用？是否需並行批改？
7. 日誌/稽核：是否需要保留批改紀錄（日誌），若有，這些日誌能否包含隱藏測資的輸出或僅紀錄結果？
8. UI 需求：僅 CLI 即可，還是需要簡單 GUI（例如 Electron）或網頁介面（即便離線，以本機佈署）？
9. 編譯器/執行環境版本：C++17、lex、yacc 經指定版本，是否需要內建交叉編譯或只使用系統已安裝的編譯器？
10. 可攜性與安裝：希望以單一二進位檔發佈（靜態編譯）還是安裝套件（apt、rpm、tar）？
11. 測資數量上限、超時與資源限制：每題可有多少測資？單次測試允許的最大執行時間、記憶體限制為何？
12. 教師功能細節：教師上傳「編譯腳本」是任何 shell script 嗎？是否需要檢查/沙箱教師腳本以避免在打包階段執行惡意命令？

請就上述各點回覆或指出您已有預設。

**建議的功能性需求（草稿，可接受修改）**

- MUST（必要）
  - 本地 CLI 工具，支援教師建立封裝（打包 + 加密）與學生在本地解封與測試。
  - 封裝包含題目 PDF、`public/` 與 `private/` 目錄（以 `.in` / `.out` 對應）、以及一個 metadata 檔（指定語言、編譯指令、測資 timeout、檔案命名規則、版本號）。
  - 支援至少 C++17、flex、bison；能接受教師指定的編譯腳本（受限於安全檢查）。
  - 隱藏測資在執行前解密，執行完畢後立即清除解密內容（包含暫存檔與記憶體敏感區）。
  - 顯示編譯錯誤、Runtime-error（含錯誤訊息）、timeout（只顯示超時）、以及是否通過（不顯示隱藏輸出）。
  - 支援下載公開測資（學生可下載對應測資的輸入/輸出）。
  - 不使用網路。
- SHOULD（建議）
  - 提供基本帳號/角色機制（至少教師與學生的分別），或以密碼權限控制存取。
  - 以 `zip` 或自定義容器格式支援版本控制與元資料（推薦採用 zip+明確 metadata JSON）。
  - 支援執行沙箱（如透過容器或系統限制）以避免學生程式破壞主機。
  - 日誌功能（不包含隱藏輸出），並可以匯出成 CSV/JSON。
- NICE TO HAVE（可選）
  - GUI 前端（簡易）或本機 Web UI（不啟用網路）以方便非 CLI 使用者。
  - 封裝簽章（數位簽章）以確保題目完整性（若有信任鏈需求）。
  - 自動化產生測資報告與統計。

**建議的非功能性需求（草稿）**

- 安全性：私有測資必須加密（建議使用 AES-GCM 對稱加密，密鑰來源由教師持有）；系統應最小化在磁碟的敏感殘留。
- 可用性：CLI 必須有清晰的子命令（`pack`、`unpack`、`submit`、`run`、`export`），使用說明與範例。
- 可移植性：支援主流 Unix-like 系統（Linux 發行版，macOS 可選）。
- 可維護性：封裝 meta 請採 JSON 格式，並在版本中明確標記。
- 性能：單位測試最多允許 N 秒（可設定），能在可接受時間內完成批改（視測資數量與時限而定）。

**建議的元檔（metadata）草案（示例）**

- `meta.json` 可能包含：
  - `version`：封裝版本
  - `language`：例如 `"cpp17"`
  - `compile_command`：例如 `"g++ -std=c++17 -O2 -pipe -o solution solution.cpp"`
  - `test_timeout_ms`：單個測資的超時（毫秒）
  - `tests`：陣列，測資編號與屬性（是否公開）
  - `pack_timestamp`、`author`、`hash`（選擇性）
    （我可以幫您產生完整 JSON schema）

**接受準則（範例）**

- 教師能用 CLI 打包題目：輸入題目 PDF、`public/`、`private/`、`meta.json`，輸出一個加密封裝檔。
- 學生能以公開密碼解出題目說明與 `public/` 測資，能上傳程式並對所有測資做測試，結果顯示通過/錯誤/超時，並能下載 `public` 測資。
- 隱藏測資在測試期間被安全使用並在測試後無法被學生讀取（驗證：以教師權限可讀，以學生權限不可讀）。
- 系統在無網路環境能完整運作。
- 支援 C++17 的編譯與執行流程能被驗證（舉例：提供一個樣題與測資測試套件做驗收）。

**風險與技術注意事項**

- 在一般作業系統上，確保「絕對不留電磁紀錄」很難達成（特別是 SSD），需要明確界定可接受的風險與做法（例如覆寫、避免 swap、將敏感資料只保存在匿名 tmpfs 中）。
- 執行未信任程式需沙箱化；否則有被濫用風險（破壞檔案、濫用 CPU/記憶體）。
- 教師提供的「編譯腳本」可能含任意命令，必須嚴格限制或審核以免在封裝或批改階段執行危險動作。
- 若採用 zip 加密，不同平台/工具對 zip 密碼加密相容性需注意；建議使用明確加密格式（例如 AES-GCM）與 metadata。

**建議的下一步**

- 請回覆上方「模糊處與釐清問題」中各項的答案（或指出優先回覆的幾項），特別是：帳號模型、密碼/金鑰管理、封裝格式、隱私擦除要求、是否需要沙箱。
- 我可以根據您的回覆立即：
  - 產生「精確的功能需求規格」（包含 meta.json schema、CLI 子命令定義與範例）
  - 或直接產出「技術設計草案」（包含加密方案、暫存處理、沙箱選項與必要系統需求）
  - 或產出「教師打包與學生測試的逐步使用手冊與 CLI 範例」
- 請告訴我您現在最優先的下個輸出：精確需求文件 / 技術設計 / CLI 原型 / 或其他。

如果您願意，我也可以先根據目前假設直接產出：

- `meta.json` 的 JSON schema + 範例
- CLI 命令清單與範例輸入輸出
- 封裝格式（zip vs custom）的比較建議與推薦實作

您想先從哪一項開始？